# üîß Script de Corre√ß√£o - Permiss√µes GHCR

## Problema Identificado

O workflow est√° **100% correto**, mas a **organiza√ß√£o avilaops** est√° bloqueando o push.

## Solu√ß√£o: Configurar na Organiza√ß√£o

### 1. Acesse as Configura√ß√µes da Org

```
https://github.com/organizations/avilaops/settings/actions
```

### 2. Na se√ß√£o "Workflow permissions"

Marque:
- ‚úÖ **Read and write permissions**  
  (Permite que GITHUB_TOKEN tenha `packages: write`)

### 3. Na se√ß√£o "Fork pull request workflows"

Marque:
- ‚úÖ **Allow GitHub Actions to create and approve pull requests**

### 4. GHCR Package Visibility (Importante!)

Acesse:
```
https://github.com/orgs/avilaops/packages
```

Se o pacote `gabriela/backend` j√° existir:
1. Clique no pacote
2. **Package settings** ‚Üí **Manage Actions access**
3. Adicione o reposit√≥rio `avilaops/gabriela` com permiss√£o **Write**

### 5. Se o problema persistir

Execute este comando no terminal (com GitHub CLI instalado):

```bash
# Login
gh auth login

# Dar permiss√£o expl√≠cita
gh api \
  --method PUT \
  -H "Accept: application/vnd.github+json" \
  /orgs/avilaops/packages/container/gabriela%2Fbackend/permissions/repositories/gabriela \
  -f permission='write'
```

## Alternativa: Usar PAT ao inv√©s de GITHUB_TOKEN

Se preferir, crie um **Personal Access Token (Fine-grained)**:

### 1. Criar o Token

```
https://github.com/settings/tokens?type=beta
```

Configura√ß√µes:
- **Resource owner**: avilaops
- **Repository access**: Only select repositories ‚Üí gabriela
- **Permissions**:
  - Repository permissions:
    - Contents: Read
  - Organization permissions:
    - Packages: Read and write

### 2. Adicionar como Secret

```bash
gh secret set GHCR_PAT -b"ghp_SEU_TOKEN_AQUI" -R avilaops/gabriela
```

### 3. Atualizar Workflow

Trocar esta linha:
```yaml
password: ${{ secrets.GITHUB_TOKEN }}
```

Por:
```yaml
password: ${{ secrets.GHCR_PAT }}
```

---

## ‚úÖ Checklist R√°pido

- [ ] Acessar `github.com/organizations/avilaops/settings/actions`
- [ ] Marcar "Read and write permissions"
- [ ] Salvar
- [ ] Re-run do workflow falho no GitHub Actions
- [ ] Se falhar, seguir passos do PAT

---

**Nota:** O workflow est√° correto. √â 100% configura√ß√£o de organiza√ß√£o.
